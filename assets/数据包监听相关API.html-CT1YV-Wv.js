import{_ as n,c as s,o as a,a as t}from"./app-DJ6fbNhj.js";const p={},c=t(`<h1 id="数据包监听相关-api" tabindex="-1"><a class="header-anchor" href="#数据包监听相关-api"><span>数据包监听相关 API</span></a></h1><h2 id="监听数据包" tabindex="-1"><a class="header-anchor" href="#监听数据包"><span>监听数据包</span></a></h2><ul><li><p>when_receive_packet_of_types(...)</p><ul><li><p>范围：协程外</p></li><li><p>说明：当机器人收到指定的数据包类型时，启动一个新的协程并运行指定处理函数</p></li><li><p>参数：</p><ul><li><p>待接收的数据包类型列表，这里有两种方式</p></li><li><p>when_receive_packet_of_types(数据包类型 1, 数据包类型 2, 数据包类型 3 ...)</p><p>e.g. :when_receive_packet_of_types(packets.Text, packets.CommandOutput)</p><p>这代表接收所罗列的数据包类型</p></li><li><p>when_receive_packet_of_types(packets.all, no 数据包类型 1, no 数据包类型 2, no 数据包类型 3 ...)</p><p>e.g. :when_receive_packet_of_types(packets.all, packets.noMovePlayer)</p><p>这代表接收除了 noXX 对应的 XX 类型数据包外的其余数据包类型 (反选)</p></li></ul></li><li><p>返回：监听器，监听器的处理函数的参数为数据包，数据包具有以下三个成员函数</p><ul><li><p>name() 数据包名，例如 &quot;IDText&quot;</p></li><li><p>id() 数据包类型编号，例如 27</p></li><li><p>user_data() 数据包数据，user_data 形式，注意，您可以访问 user_data 形式数据包内部的成员</p><p>但是，user_data 并非普通的 lua 数据结构，因此您无法使用 pair 或 ipair 遍历数据包内部结构</p><p>您可以使用 ud2lua 函数将 user_data 转换为普通的 lua 数据结构以使用 pair 或 ipair,</p><p>但是，ud2lua 会造成额外的性能开销，因此您应该尽量避免使用 ud2lua 函数以提高插件性能</p></li></ul></li></ul></li></ul><div class="language-lua line-numbers-mode" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line"><span class="token keyword">local</span> packets <span class="token operator">=</span> omega<span class="token punctuation">.</span>packets</span>
<span class="line">coromega<span class="token punctuation">:</span><span class="token function">when_receive_packet_of_types</span><span class="token punctuation">(</span>packets<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> packets<span class="token punctuation">.</span>CommandOutput<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">start_new</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span></span>
<span class="line">    coromega<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;packet name: %s id: %s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span>packet<span class="token punctuation">:</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> packet<span class="token punctuation">:</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> packet<span class="token punctuation">:</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> packets<span class="token punctuation">.</span>CommandOutput <span class="token keyword">then</span></span>
<span class="line">        coromega<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;detail packet %s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span>packet<span class="token punctuation">:</span><span class="token function">json_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">local</span> packet_userdata <span class="token operator">=</span> packet<span class="token punctuation">:</span><span class="token function">user_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        coromega<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;detail packet (user_data) %s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span>packet_userdata<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        coromega<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;detail packet (lua table) %s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token function">ud2lua</span><span class="token punctuation">(</span>packet_userdata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        coromega<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;Origin: %s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span>packet_userdata<span class="token punctuation">.</span>CommandOrigin<span class="token punctuation">.</span>Origin<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        coromega<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;OutputMessages[0].Message: %s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span>packet_userdata<span class="token punctuation">.</span>OutputMessages<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line"><span class="token keyword">end</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">coromega<span class="token punctuation">:</span><span class="token function">when_receive_packet_of_types</span><span class="token punctuation">(</span>packets<span class="token punctuation">.</span>all<span class="token punctuation">,</span> packets<span class="token punctuation">.</span>noMovePlayer<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="综合使用" tabindex="-1"><a class="header-anchor" href="#综合使用"><span>综合使用</span></a></h2><div class="language-lua line-numbers-mode" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line"><span class="token keyword">local</span> omega <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;omega&quot;</span><span class="token punctuation">)</span></span>
<span class="line">package<span class="token punctuation">.</span>path <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;%s;%s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span></span>
<span class="line">    package<span class="token punctuation">.</span>path<span class="token punctuation">,</span></span>
<span class="line">    omega<span class="token punctuation">.</span>storage_path<span class="token punctuation">.</span><span class="token function">get_code_path</span><span class="token punctuation">(</span><span class="token string">&quot;LuaLoader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;?.lua&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">local</span> coromega <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;coromega&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>omega<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">local</span> packets <span class="token operator">=</span> omega<span class="token punctuation">.</span>packets</span>
<span class="line">coromega<span class="token punctuation">:</span><span class="token function">when_receive_packet_of_types</span><span class="token punctuation">(</span>packets<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> packets<span class="token punctuation">.</span>CommandOutput<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">start_new</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>packet<span class="token punctuation">)</span></span>
<span class="line">    coromega<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;packet name: %s id: %s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span>packet<span class="token punctuation">:</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> packet<span class="token punctuation">:</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> packet<span class="token punctuation">:</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> packets<span class="token punctuation">.</span>CommandOutput <span class="token keyword">then</span></span>
<span class="line">        coromega<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;detail packet %s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span>packet<span class="token punctuation">:</span><span class="token function">json_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">local</span> packet_userdata <span class="token operator">=</span> packet<span class="token punctuation">:</span><span class="token function">user_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        coromega<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;detail packet (user_data) %s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span>packet_userdata<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        coromega<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;detail packet (lua table) %s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token function">ud2lua</span><span class="token punctuation">(</span>packet_userdata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        coromega<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;Origin: %s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span>packet_userdata<span class="token punctuation">.</span>CommandOrigin<span class="token punctuation">.</span>Origin<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        coromega<span class="token punctuation">:</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;OutputMessages[0].Message: %s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">format</span><span class="token punctuation">(</span>packet_userdata<span class="token punctuation">.</span>OutputMessages<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line"><span class="token keyword">end</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">coromega<span class="token punctuation">:</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),o=[c];function e(u,l){return a(),s("div",null,o)}const k=n(p,[["render",e],["__file","数据包监听相关API.html.vue"]]),r=JSON.parse('{"path":"/lua%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99/%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9B%91%E5%90%AC%E7%9B%B8%E5%85%B3API/%E6%95%B0%E6%8D%AE%E5%8C%85%E7%9B%91%E5%90%AC%E7%9B%B8%E5%85%B3API.html","title":"数据包","lang":"zh-CN","frontmatter":{"lang":"zh-CN","title":"数据包","description":"数据包监听相关示例"},"headers":[{"level":2,"title":"监听数据包","slug":"监听数据包","link":"#监听数据包","children":[]},{"level":2,"title":"综合使用","slug":"综合使用","link":"#综合使用","children":[]}],"git":{"updatedTime":1727773696000,"contributors":[{"name":"RainyHallways","email":"78735995+RainyHallways@users.noreply.github.com","commits":1}]},"filePathRelative":"lua插件编写/数据包监听相关API/数据包监听相关API.md"}');export{k as comp,r as data};
